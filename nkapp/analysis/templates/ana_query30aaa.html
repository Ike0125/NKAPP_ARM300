<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>条件による表示切替</title>
  <style>
    .hidden { display: none; }
  </style>
  <script src="/static/js/dropdown.js"></script>
</head>
<body>

<h1>Analysis</h1>
  <h2>Query Setting</h2>
  <form action="/nkapp/analysis/query_builder2" method="POST">

    <label for="dropdown001">Query:</label>
    <select name="dropdown001" id="dropdown001" onchange="toggleInputs()">
      <option value="">選択してください</option>
      {% for value, text in VALUE_MAP50.items() %}
        <option value="{{ value }}" {% if condition001==value %}selected{% endif %}>{{ text }}</option>
      {% endfor %}
    </select>

    <h3>Calc-Group A</h3>
    <div id="input101">
      <label for="dropdown101">移動平均:</label>
      <select name="dropdown101" id="dropdown101" required>
          <option value="{{window101}}">選択してください</option>
          <option value="{{ma_value01}}" {% if ma_value01 == window101 %}selected{% endif %}>MA1:{{ma_value01}}days</option>
          <option value="{{ma_value02}}" {% if ma_value02 == window101 %}selected{% endif %}>MA2:{{ma_value02}}days</option>
          <option value="{{ma_value03}}" {% if ma_value03 == window101 %}selected{% endif %}>MA3:{{ma_value03}}days</option>
          <option value="{{ma_value04}}" {% if ma_value04 == window101 %}selected{% endif %}>MA4:{{ma_value04}}days</option>
          <option value="{{ma_value05}}" {% if ma_value05 == window101 %}selected{% endif %}>MA5:{{ma_value05}}days</option>
      </select>
    </div>
    <div id="input102">
      <p>Formula:{{comment102}}</p>
    </div>

    <div id="input111">
      <label for="gap111"> {{daygapname111}}:</label>
      <input type="number" min="0" max="400" step="1" id="gap111"
      name="gap111" value="{{ gapquery111 }}">
    </div>

    <div id="input121">
      <label for="param121"> {{paramname121}}:</label>
      <input type="number" style="width:50px" step="0.01" id="param121"
      name="param121" value="{{paramquery121}}"><br>
    </div>

    <div id="input122">
      <label for="param122"> {{paramname122}}:</label>
      <input type="number" style="width:50px" step="0.01" id="param122"
      name="param122" value="{{paramquery122}}"><br>
    </div>

    <div id="input123">
      <p>{{subject123}}:{{comment123}}</p>
    </div>
    <div id="input124">
      <p>{{subject124}}:{{comment124}}</p>
    </div>
    <div id="input125">
      <p>{{subject125}}:{{comment125}}</p>
    </div>

    <h3>Operator</h3>
    <div id="input131">
      <label for="dropdown131">演算子:</label>
      <select name="dropdown131" id="dropdown131" >
        <option value="">選択してください</option>
        {% for value, text in VALUE_MAP30.items() %}
          <option value="{{ value }}" {% if value == ope_select131 %}selected{% endif %}>{{ text }}</option>
        {% endfor %}
      </select>
    </div>

    
    <h3>Calc-Group B</h3>
    <div id="input201">
      <label for="dropdown201">移動平均:</label>
      <select name="dropdown201" id="dropdown201" required>
          <option value="{{window101}}">選択してください</option>
          <option value="{{ma_value01}}" {% if ma_value01 == window201 %}selected{% endif %}>MA1:{{ma_value01}}days</option>
          <option value="{{ma_value02}}" {% if ma_value02 == window201 %}selected{% endif %}>MA2:{{ma_value02}}days</option>
          <option value="{{ma_value03}}" {% if ma_value03 == window201 %}selected{% endif %}>MA3:{{ma_value03}}days</option>
          <option value="{{ma_value04}}" {% if ma_value04 == window201 %}selected{% endif %}>MA4:{{ma_value04}}days</option>
          <option value="{{ma_value05}}" {% if ma_value05 == window201 %}selected{% endif %}>MA5:{{ma_value05}}days</option>
      </select>
    </div>
    <div id="input202">
      <p>Formula:{{comment202}}</p>
    </div>

    <div id="input211">
      <label for="gap211"> {{daygapname211}}:</label>
      <input type="number" min="0" max="400" step="1" id="gap211"
      name="gap211" value="{{ gapquery211 }}">
    </div>

    <div id="input221">
      <label for="param221"> {{paramname221}}:</label>
      <input type="number" style="width:50px" step="0.01" id="param221"
      name="param221" value="{{paramquery221}}"><br>
    </div>

    <div id="input222">
      <label for="param222"> {{paramname222}}:</label>
      <input type="number" style="width:50px" step="0.01" id="param122"
      name="param222" value="{{paramquery222}}"><br>
    </div>

    <div id="input223">
      <p>{{subject223}}:{{comment223}}</p>
    </div>
    <div id="input224">
      <p>{{subject224}}:{{comment224}}</p>
    </div>
    <div id="input225">
      <p>{{subject225}}:{{comment225}}</p>
    </div>

    <br>
    <h3>Display Pannel</h3>
    <label for="dropdown501">ソート順:</label>
    <select name="dropdown501" id="dropdown501" >
      <option value="">選択してください</option>
      {% for value, text in VALUE_MAP40.items() %}
        <option value="{{ value }}" {% if value == sort_select501 %}selected{% endif %}>{{ text }}</option>
      {% endfor %}
    </select>
    <br>

    <p id="noInput" class="hidden">入力項目はありません</p>

    <input type="submit" value="検索">

    <p>condition:{{condition}}</p>
    <p>condition001:{{condition001}}</p>
    <p>window101:{{window101}}</p>
    <p>gapquery111:{{gapquery111}}</p>
    <p>paramquery121:{{paramquery121}}</p>
    <p>paramquery122:{{paramquery122}}</p>
    <p>ope_select131:{{ope_select131}}</p>

    <p>window201:{{window201}}</p>
    <p>gapquery211:{{gapquery211}}</p>
    <p>paramquery221:{{paramquery221}}</p>
    <p>paramquery222:{{paramquery222}}</p>
    <p>sort_select501:{{sort_select501}}</p>

    <br>
    <p>marketcode   :{{marketcode}}</p>
    <p>selected10   :{{selected10}}</p>
    <p>rsi_period_value:{{rsi_period_value}}</p>
    <p>macd_short_value:{{macd_short_value}}</p>
    <p>macd_long_value :{{macd_long_value}}</p>
    <p>macd_signal_value:{{macd_signal_value}}</p>

  </form>

<script>
  // 条件ごとの表示設定をオブジェクトで管理
  const displaySettings = {
    "0501": { input101: true, input111: true, input121: false, input122: false, input131:true,
    input201: false, input211: false, input221: true, input222: false,
    input102: false, input123: false, input124: false, input125: false,
    input202: true, input223: false, input224: false, input225: false},
    "0502": { input101: true, input111: true, input121: false, input122: false, input131:true,
    input201: true, input211: true, input221: false, input222: false,
    input102: false, input123: false, input124: false, input125: false,
    input202: false, input223: false, input224: false, input225: false},
    "0503": { input101: true, input111: true, input121: false, input122: false, input131:true,
    input201: true, input211: true, input221: false, input222: false,
    input102: false, input123: false, input124: false, input125: false,
    input202: false, input223: false, input224: false, input225: false},
    "0504": { input101: true, input111: true, input121: false, input122: false, input131:true,
    input201: false, input211: true, input221: false, input222: false,
    input102: false, input123: false, input124: false, input125: false,
    input202: false, input223: false, input224: false, input225: false},
    "0511": { input101: false, input111: true, input121: false, input122: false, input131:true,
    input201: false, input211: false, input221: true, input222: false,
    input102: true, input123: false, input124: false, input125: false,
    input202: false, input223: false, input224: false, input225: false},
    "0521": { input101: false, input111: false, input121: false, input122: false, input131:true,
    input201: false, input211: false, input221: false, input222: false,
    input102: true, input123: true, input124: false, input125: false,
    input202: false, input223: true, input224: false, input225: false},
    "0523": { input101: false, input111: false, input121: false, input122: false, input131:true,
    input201: false, input211: false, input221: false, input222: false,
    input102: true, input123: true, input124: false, input125: false,
    input202: false, input223: true, input224: false, input225: false},
    "0591": { input101: true, input111: true, input121: true, input122: true, input131:true,
    input201: true, input211: true, input221: true, input222: true,
    input102: true, input123: true, input124: true, input125: true,
    input202: true, input223: true, input224: true, input225: true},
    "0592": { input101: false, input111: false, input121: false, input122: false, input131:false,
    input201: false, input211: false, input221: false, input222: false,
    input102: false, input123: false, input124: false, input125: false,
    input202: false, input223: false, input224: false, input225: false},
    };

  function toggleInputs() {
    const condition = document.getElementById("dropdown001").value;
    const noInput = document.getElementById("noInput");

    // 全ての入力項目を一旦非表示にする
    document.querySelectorAll('[id^="input"]').forEach(input => {
      input.style.display = "none";
    });
    noInput.classList.add("hidden");

    // 条件に基づき、表示を制御
    if (displaySettings[condition]) {
      const settings = displaySettings[condition];
      let hasVisibleInput = false;

      for (const [inputId, isVisible] of Object.entries(settings)) {
        const element = document.getElementById(inputId);
        if (element && isVisible) {
          element.style.display = "block";
          hasVisibleInput = true;
        }
      }

      // すべて非表示の場合、"入力項目はありません"メッセージを表示
      if (!hasVisibleInput) {
        noInput.classList.remove("hidden");
      }
    }
  }

  // 初期状態で実行
  toggleInputs();
</script>

</body>
</html>
